<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){
        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 

        //Initial Variables
        var loaddata = "";
      	var topicheads = "<tr>"+"<th><b>Date</b></th>"+"<th><b>Subject</b></th>"+"<th>Sender</th>"+"</tr>";
      	var getnewm = topicheads;
      	var test = "hi";
      	var count = 0;

        //Loading 10 inital messages into a table using for loop
				for (i = 0; i < geemails.length; i++) {
    			loaddata += "<tr>"+ "<td>"+geemails[i].date+"</td>" + "<td>"+geemails[i].subject+"</td>" + "<td>"+geemails[i].sender+"</td>" +"</tr>"
    			+"<tr><td colspan='3'>"+geemails[i].body;+"</td></tr>";
				}

				//Display initial messages and initial inbox count on screen
				document.getElementById("inboxcount").innerHTML =  "Inbox (10)";
				document.getElementById("loadmail").innerHTML =  topicheads + loaddata;

				//Hide the display of the even rows in loaddata
				for (i = 1; i < geemails.length*2+1; i++) {
           if(i%2==0){
              document.getElementById("loadmail").rows[i].cells[0].style.display = "none";
           }
				}
				
				//Adding EventListners to all the odd rows of loaddata
				for (let i = 0; i <= geemails.length*2; i++) {
    			if(i%2==1){
    				document.getElementById("loadmail").rows[i].addEventListener('click', function() { viewMessage(i, 1); } );
					}
				}

				//This function can display the even rows of loaddata and newMessageGet
      	function viewMessage(num, checkp) {

      		if (checkp == 1) {
      			var a = document.getElementById("loadmail").rows[num+1].cells[0];
      		} else if (checkp == 2) {
      			var a = document.getElementById("n.m").rows[num+1].cells[0];
      		}

   			 	if (a.style.display === "none") {
        		a.style.display = "table-cell";
    			} else {
        		a.style.display = "none";
    			}
      	}

				//Creates a new message with similar properties as the 10 inital messages every 5 seconds
				var myTim = setInterval(newMessageGet, 15000);

				//This function is called on by myTim to display getNewMessage properites on screen
				function newMessageGet() {
					var b = "<tr>"+ "<td>"+getNewMessage().date+"</td>" + "<td>"+getNewMessage().subject+"</td>" + "<td>"+getNewMessage().sender+"</td>" +"</tr>"+"<tr><td colspan='3'>"+getNewMessage().body+"</td></tr>";
					getnewm += b;
					document.getElementById("n.m").innerHTML = getnewm;
					newMessageToggle();

					count ++;
					if(count==50) {
      			clearInterval(myTim);
      		}

      		//Update the number of messages in the inbox
      		var inboxnum = count+10;
      		document.getElementById("inboxcount").innerHTML =  "Inbox ("+inboxnum+")";

				}

				//This function is called on by getNewMessageGet to toggle the display of the even rows
				function newMessageToggle() {
					for (i = 1; i < count*2+4; i++) {
        	 	if(i%2==0){
             	document.getElementById("n.m").rows[i].cells[0].style.display = "none";
         		}
					}

					//Add toggle functionality to the rows
					for (let j = 0; j < count*2+3; j++) {
    				if(j%2==1){
    					document.getElementById("n.m").rows[j].addEventListener('click', function() { viewMessage(j, 2); } );
						}
					}
				}


      };

    </script>

	</head>

	<body>
		<header><h1>Gee-Mail</h1></header>
		<br>

		<div class="container" id="main">
			
			<div id="inboxcount"></div>
			<div><h3>Old Messages</h3></div>
			<table id="loadmail"></table>
			<br>
			
			<div><h3>New Messages</h3></div>
			<table id="n.m"></table>

		</div>

	</body>
</html>